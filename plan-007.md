### 需求

考虑到，如果玩家随机到了诸葛亮，就算不告诉玩家诸葛亮的名字，但也很容易猜出是诸葛亮，然后什么事都听他的就好，这样会很无聊。
所以，我觉得游戏应该先随机生成角色，而不是简单的随机一张角色卡。
举个例子，我们需要一个丞相，就应该从配置了通用丞相卡的角色卡里选几张出来，最好是忠臣奸臣都有，譬如合成一个诸葛亮加严嵩加和珅的这种丞相，这样更有意思。

我觉得可以给角色一组 tag（多个 tag），这样管理起来更简单，毕竟现在希望知道 丞相，还希望知道 忠臣奸臣，如果一定要展开就需要加 2 个属性，所以给一个 tag list，会更加灵活。

关于角色名字，我希望用事件最多的那个角色的姓，然后生成一个 名 和 字，类似 诸葛 亮 字 孔明 这样。
可能会需要实现一个随机角色名字生成器，其实玩家的名字可能也需要有个随机的可能。

角色的基础属性，应该用这些角色里数值最大的那个，上面那个例子里，应该是严嵩的权势最大，和珅的财富最大，所以权势应该用严嵩的财富用和珅的。

### 名字生成器实现方案

1. 姓氏来源
   - 统计合成所用角色卡中，事件数量最多的那一张，取其姓氏作为新角色的姓。
   - 姓氏字段可在角色卡数据中单独列出，便于提取。

2. 名与字生成
   - 名和字可通过预设的常用汉字、历史人物名库、或随机组合生成。
   - 支持配置常用名/字词库，或通过算法自动生成（如拼音、部首等规则）。
   - 可考虑避免与历史真实人物完全重名。

3. 接口建议
   - 在 `core/src/engine/CharacterGenerator.ts` 中实现：
     ```typescript
     export function generateCharacterName(baseSurnames: string[], options?: NameGenOptions): { surname: string; name: string; courtesyName: string }
     ```
   - 其中 `baseSurnames` 为合成角色卡的姓氏列表，自动选取事件最多者。

4. 生成流程
   - 合成角色时，先确定姓氏，再生成名和字，最终组装为完整姓名。

5. 可扩展性
   - 名字生成逻辑可独立于角色生成主流程，便于后续优化和扩展。

6. 名字显示与合法性定义
    - 角色姓名显示建议：
        - 角色首次介绍或详情页，完整显示“姓 名 字 字号”，如“诸葛 亮 字 孔明”。
        - 游戏主界面、对话等场景，优先显示“名”或“姓名”，如“亮”或“诸葛亮”。
        - 正式场合可显示全名带字号，详情页可补充“字”的含义。
    - 角色卡名字合法性：
        - 生成的新角色姓名不得与历史真实人物完全重名（如“武则天”、“刘备”等），需在生成逻辑中校验并剔除。
        - 可维护一份历史人物姓名黑名单，生成时自动避开。
        - 如遇冲突，可自动调整名或字，或重新生成。

---


### 实现方案

#### 需求补充说明

为提升游戏可玩性与角色多样性，角色生成流程需满足以下要点：

1. 角色生成不再直接随机一张历史角色卡，而是根据所需 tag（如“丞相”）筛选多张角色卡，组合生成新角色。
2. 新角色的姓氏取自合成所用角色卡中事件数量最多者，名和字通过常用汉字库或算法随机生成。
3. 角色基础属性（CharacterAttributes）合成规则如下（**特别标注**）：
   - power、military、wealth、popularity 均取所有合成角色卡中该项的最大值；
   - health 和 age 取所有合成角色卡该项的平均值（向下取整）；
   - 其余如有新属性，需在实现时补充规则。
4. 角色卡需支持 `tags: string[]` 字段，便于灵活筛选（如“丞相”、“忠臣”、“奸臣”等）。
5. 角色姓名需校验合法性，避免与历史真实人物重名，黑名单由 `gameconfig/forbidden_names.json` 维护。
6. 角色生成接口建议：
   - `core/src/engine/CharacterGenerator.ts` 提供 `generateCharacterByTags(tags: string[], options?: GenerateOptions): CharacterCard`，自动调用名字生成器并校验姓名。
7. 姓名显示规则：首次介绍/详情页显示全名及字号，主界面/对话优先显示“名”或“姓名”。

---


1. 角色卡数据结构调整
   - 在 `gameconfig/versions/*/characters/` 的角色卡数据中，增加 `tags: string[]` 字段，用于标记如“丞相”、“忠臣”、“奸臣”等属性。
   - 每张角色卡可配置多个 tag，便于灵活筛选和扩展。
   - 角色卡的 `name` 字段应采用统一格式，约定为“姓 名”，各部分用一个空格隔开。例如：
     - 诸葛 亮
     - 刘 备
   - 这样便于解析和展示，无需结构更复杂。
   - 示例：
     ```json
     {
       "id": "char001",
       "name": "诸葛 亮",
       "tags": ["丞相", "忠臣"]
     }
     ```

2. 角色生成逻辑（core 层实现）
   - 在 core 新增 `CharacterGenerator` 类或方法，支持根据指定 tag（如“丞相”）筛选所有符合条件的角色卡。
   - 随机组合多张不同风格（如忠臣、奸臣）的角色卡，合成一个新角色。属性、技能等可按权重或规则混合。
   - 生成的新角色不直接暴露原型名称，避免玩家一眼识破。

3. 配置与适配
   - 角色生成逻辑只依赖 core 层的类型和数据接口，不引入配置管理依赖。
   - 由 editor 工具辅助配置和调试角色标签，确保数据一致性。
   - 通过 core 的 `ConfigValidator` 校验新角色数据合法性。
    - 角色生成后需校验姓名合法性（如与黑名单冲突自动调整）。

4. UI 与交互
   - prototype 前端通过 adapter 层调用角色生成接口，展示合成后的新角色。
   - editor 提供角色标签编辑和预览功能，便于内容创作。

5. 代码与接口建议
   - 新增 `core/src/engine/CharacterGenerator.ts`，实现角色筛选与合成逻辑。
   - 角色生成接口建议：
     ```typescript
     // core
     export function generateCharacterByTags(tags: string[], options?: GenerateOptions): CharacterCard
     ```
   - 保持 core 层纯净，所有数据路径通过 `GameConfigManager.getConfigPath()` 获取。
    - 角色生成接口应自动调用名字生成器，确保生成角色时姓名合法。
    - 黑名单建议在 `gameconfig/forbidden_names.json` 维护，便于版本管理和扩展。


6. 流程示意
   - 需求角色（如“丞相”）时，调用生成接口，传入所需 tag list。
   - 系统自动筛选、组合并生成新角色，供游戏流程使用。
     - **注意：在名字生成器功能未完成前，角色名暂时直接采用事件最多的那个角色卡的名字（如“诸葛 亮”），不做名和字的随机生成。后续如实现名字生成器再切换为自动生成。**
     - 生成角色后，自动校验姓名合法性，必要时重新生成。
     - 支持多语言/本地化时，名字生成和显示逻辑可预留扩展点。

---


---

### 实现细节补充建议

1. **黑名单 forbidden_names.json 格式示例**
   - 建议格式为字符串数组，例如：
     ```json
     ["武则天", "刘备", "曹操"]
     ```
   - 可由 editor 工具辅助维护和校验。
   - **注意：由于角色名为“姓 名 字”格式，名字校验接口需能正确识别和比对黑名单（如只比对“姓 名”或全名），避免因格式不同导致校验失效。需在实现时做特殊处理。**

2. **属性合成的类型安全与健壮性**
   - 合成属性时需确保类型安全，health/age 取平均值时向下取整。
   - 对空数组、异常数据需做健壮性处理，避免出错。


3. **常用名/字词库的扩展**（**当前阶段不需要考虑多语言，仅需支持中文**）
   - 建议将词库存放于 `gameconfig/names/` 目录。
   - 词库结构建议为：
     ```json
     ["亮", "云", "孔明"]
     ```

4. **角色卡 JSON Schema 变更说明**
   - 明确 `tags: string[]` 字段为必填，`name` 字段需校验格式（如“姓 名”）。
   - 建议维护 schema 校验工具，便于数据一致性。

5. **自动化测试与验证流程**
   - 每次角色生成逻辑或数据结构调整后，需通过 core 层的 ConfigValidator 及自动化测试用例验证。

6. **版本兼容与数据迁移提示**
   - 如已有历史数据，需补充数据迁移或兼容性处理建议，避免老数据缺失 tags 字段等问题。

---


---

### 文档同步与维护说明

方案完成后，需同步更新以下文档，确保所有开发者文档与实现保持一致：
- 项目根目录及 core/README.md，补充角色生成、属性合成、姓名校验、tags 字段等设计要点
- 相关数据结构与接口说明文档
- 迁移/变更报告（如 plan-007-report.md）
- 其他涉及角色生成与数据结构的说明文档

请在每次主要实现或数据结构调整后，及时同步文档，便于团队协作和后续维护。

这样设计可以极大提升角色生成的多样性和可玩性，同时保持架构清晰、易于扩展。